/*
                             *******************
******************************* C SOURCE FILE ********************************
**                           *******************                            **
**                                                                          **
**  Project   : E100_LDC                                                    **
**  Filename  : spc570_hal_pit.c                                            **
**  Version   : -.- (PCB : )                                                **
**  Date      : 2019.07.16                                                  **
**                                                                          **
******************************************************************************
**                                                                          **
**  (c) 2019 YOUNG HWA TECH Co., Ltd. All Rights Reserved                   **
**                                                                          **
**                       YOUNG HWA TECH Co., Ltd.                           **
******************************************************************************

VERSION HISTORY:
----------------

Version     : -.-
Date        : ----.--.--
Revised by  : Tran Duc Hung
Description : Original version.

*/

#define SPC570_HAL_PIT_C_SRC

/****************************************************************************/
/**                                                                        **/
/**                      MODULES USED                                      **/
/**                                                                        **/
/****************************************************************************/
#include "spc570_hal_pit.h"

/****************************************************************************/
/**                                                                        **/
/**                      DEFINITIONS AND MACROS                            **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                      TYPEDEFS AND STRUCTURES                           **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                      PROTOTYPES OF LOCAL FUNCTIONS                     **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                      EXPORTED VARIABLES                                **/
/**                                                                        **/
/****************************************************************************/
volatile uint8_t u8g_task_flag_1m = TRUE;
uint8_t u8g_task_10m_cnt = 10U;
uint8_t u8g_task_100m_cnt = 105U;
uint16_t u16g_task_7s_cnt = 7000U;

/***********************************************************5*****************/
/**                                                                        **/
/**                      GLOBAL VARIABLES                                  **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                      EXPORTED FUNCTIONS                                **/
/**                                                                        **/
/****************************************************************************/
/*--------------------------------------------------------------------------*/
/* Function  |                                                              */
/* Name      |                                                              */
/*--------------------------------------------------------------------------*/
/* Parameter | Nothing                                                      */
/* Return    | Nothing                                                      */
/*--------------------------------------------------------------------------*/
void spc570_hal_pit_Init ( void )
{
  SPCSetPeripheralClockMode( SPC5_PIT_PCTL, SPC5_ME_PCTL_RUN( 2 ) | SPC5_ME_PCTL_LP( 2 ) );

  PIT_0.MCR.R      		= 1U;      /* PIT clock enabled, stop while debugging. */
  PIT_0.CH[3].LDVAL.R = 15999U;	 /* PIT clock 16Mhz, period = 1ms => counter =  16MHz/1kHz -1*/
  PIT_0.CH[3].CVAL.R  = 15999U;
  PIT_0.CH[3].TFLG.R  = 1U;      /* Interrupt flag cleared.                  */
  PIT_0.CH[3].TCTRL.R = 3U;      /* Timer active, interrupt enabled.         */

  INTC_PSR( SPC_PIT_CH3_INT_NUMBER ) = INTC_PSR_ENABLE( INTC_PSR_CORE0, 4 );
}

/*--------------------------------------------------------------------------*/
/* Function  |                                                              */
/* Name      |                                                              */
/*--------------------------------------------------------------------------*/
/* Parameter | Nothing                                                      */
/* Return    | Nothing                                                      */
/*--------------------------------------------------------------------------*/
IRQ_HANDLER( SPC_PIT_CH3_HANDLER )
{
	IRQ_PROLOGUE();

	u8g_task_flag_1m = TRUE; /* Resets the PIT channel 0 IRQ flag.*/

	PIT_0.CH[ 3 ].TFLG.R = 0x1U;

	IRQ_EPILOGUE();
}

/*--------------------------------------------------------------------------*/
/* Function  |             Period time : 100us, Execution time : 12.5us     */
/* Name      |                                                              */
/*--------------------------------------------------------------------------*/
/* Parameter | Nothing                                                      */
/* Return    | Nothing                                                      */
/*--------------------------------------------------------------------------*/
uint32_t Get_PIT_CH3_CVAL ( void )
{
	uint32_t u32_Ret;

	u32_Ret = PIT_0.CH[ 3 ].CVAL.R;

	return ( u32_Ret );
}

/****************************************************************************/
/**                                                                        **/
/**                      LOCAL FUNCTIONS                                   **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                      EOF                                               **/
/**                                                                        **/
/****************************************************************************/
